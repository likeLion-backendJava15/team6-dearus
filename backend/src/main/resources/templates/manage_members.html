<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>ì¼ê¸°ì¥ ë©¤ë²„ ê´€ë¦¬</title>
    <style>
      body {
        padding: 30px;
        background-color: #ffffff;
      }

      h2 {
        margin-bottom: 20px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      th,
      td {
        padding: 12px 15px;
        border-bottom: 1px solid #ddd;
        text-align: left;
      }

      th {
        background-color: #f0f0f0;
      }

      tr:hover {
        background-color: #f7faff;
      }

      .btn {
        padding: 6px 10px;
        font-size: 13px;
        border-radius: 6px;
        border: none;
        font-weight: bold;
        cursor: pointer;
      }

      .btn-danger {
        background-color: #e87a7a;
        color: white;
      }

      .btn-danger:hover {
        background-color: #d9534f;
      }

      .invite-form {
        margin-top: 30px;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        max-width: 400px;
      }

      .invite-form input[type="email"] {
        width: 70%;
        padding: 8px;
        font-size: 14px;
      }

      .invite-form button {
        padding: 8px 12px;
        margin-left: 10px;
        font-size: 14px;
        background-color: #4a90e2;
        color: white;
        border: none;
        border-radius: 6px;
      }

      .invite-form button:hover {
        background-color: #357ac8;
      }
    </style>
  </head>
  <body>
    <div th:replace="~{fragments/header :: header}"></div>
    <h2>ğŸ‘¥ ë©¤ë²„ ê´€ë¦¬</h2>

    <table>
      <thead>
        <tr>
          <th>ë‹‰ë„¤ì„</th>
          <th>ì—­í• </th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="member : ${members}">
          <td th:text="${member.nickname}">ë‹‰ë„¤ì„</td>
          <td>
            <span th:if="${member.role.name() == 'OWNER'}">ğŸ‘‘ Owner</span>
            <span th:if="${member.role.name() == 'GUEST'}">ğŸ‘¤ Guest</span>
          </td>
          <td>
            <button
              class="btn btn-danger"
              th:if="${member.role.name() == 'GUEST'}"
              th:onclick="|kickMember(${diaryId}, ${member.id})|"
            >
              ğŸš« ì¶”ë°©
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="invite-form">
      <h3>ğŸ“¨ ìƒˆ ë©¤ë²„ ì´ˆëŒ€</h3>
      <input type="email" id="invite-email" placeholder="ì´ë©”ì¼ ì…ë ¥" />
      <button onclick="sendInvite()">ì´ˆëŒ€</button>
    </div>

    <script>
      const diaryId = [[${diaryId}]];

      function kickMember(diaryId, memberId) {
        if (!confirm("ì •ë§ ì¶”ë°©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        fetch(`/api/diary/${diaryId}/members/${memberId}`, { method: "DELETE" })
          .then((res) => {
            if (!res.ok) throw new Error("ì¶”ë°© ì‹¤íŒ¨");
            alert("ì¶”ë°© ì™„ë£Œ");
            location.reload();
          })
          .catch((err) => alert(err.message));
      }

      function sendInvite() {
        const email = document.getElementById("invite-email").value.trim();

        if (!email) {
          alert("ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        fetch(`/api/diary/${diaryId}/invite`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email }),
        })
          .then((res) => {
            if (!res.ok) throw new Error("ì´ˆëŒ€ ì‹¤íŒ¨");
            alert("ì´ˆëŒ€ ì „ì†¡ ì™„ë£Œ");
            document.getElementById("invite-email").value = "";
          })
          .catch((err) => alert(err.message));
      }
    </script>
  </body>
</html>

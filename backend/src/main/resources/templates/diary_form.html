<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title th:text="${editMode} ? 'ì¼ê¸°ì¥ ìˆ˜ì •' : 'ìƒˆ ì¼ê¸°ì¥ ìƒì„±'">
      ì¼ê¸°ì¥
    </title>
    <link rel="stylesheet" th:href="@{/css/common.css}" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css"
    />
    <style>
      .btn {
        padding: 10px 30px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <div th:replace="~{fragments/header :: header}"></div>
    <h2
      style="color: #4271a7"
      th:text="${editMode} ? 'âœï¸ ì¼ê¸°ì¥ ì´ë¦„ ìˆ˜ì •' : 'ğŸ“š ìƒˆ ì¼ê¸°ì¥ ìƒì„±'"
    ></h2>

    <!-- ì…ë ¥ì°½ -->
    <input
      type="text"
      id="diaryName"
      name="name"
      th:value="${diary.name}"
      placeholder="ì¼ê¸°ì¥ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
      required
    />

    <!-- ë²„íŠ¼ (JSì—ì„œ ì²˜ë¦¬) -->
    <div>
      <button
        type="button"
        id="submitBtn"
        class="btn"
        th:text="${editMode} ? 'ìˆ˜ì •' : 'ìƒì„±'"
      ></button>
    </div>

    <br />
    <a th:href="@{/diary}"><button class="btn">â† ëª©ë¡ìœ¼ë¡œ</button></a>

    <!-- JSë¡œ POST or PUT ìš”ì²­ ì²˜ë¦¬ -->
    <script th:inline="javascript">
      const editMode = [[${editMode}]];
      const diaryId = [[${diaryId}]];
      const submitBtn = document.getElementById("submitBtn");

      submitBtn.addEventListener("click", () => {
        const name = document.getElementById("diaryName").value.trim();
        if (!name) {
          alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        const url = editMode ? `/api/diary/${diaryId}` : `/api/diary`;
        const method = editMode ? "PUT" : "POST";

        fetch(url, {
          method: method,
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ name }),
        })
          .then((res) => {
            if (!res.ok) throw new Error("ìš”ì²­ ì‹¤íŒ¨");
            return res.json();
          })
          .then((data) => {
            alert(editMode ? "ìˆ˜ì • ì™„ë£Œ" : "ìƒì„± ì™„ë£Œ");
            location.href = "/diary";
          })
          .catch((err) => alert(err.message));
      });
    </script>
  </body>
</html>
